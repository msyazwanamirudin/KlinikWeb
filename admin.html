<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinic Efficiency Audit | Klinik</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&family=Space+Grotesk:wght@500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="admin.css">
</head>

<body>
    <canvas id="particleCanvas"></canvas>
    <div class="audit-bg"></div>
    <!-- Progress Bar -->
    <div class="audit-progress">
        <div class="audit-progress-fill" id="progressFill" style="width:25%"></div>
    </div>

    <div class="audit-container" id="auditContainer">
        <!-- Step 1: Welcome -->
        <div class="audit-step active" id="step1">
            <div class="audit-card text-center">
                <div class="step-dots"><span class="step-dot active"></span><span class="step-dot"></span><span
                        class="step-dot"></span></div>
                <div class="audit-logo" style="position:relative">
                    <div class="pulse-ring"></div>
                    <i class="fas fa-plus"></i>
                </div>
                <h1 class="audit-title">Clinic Efficiency Audit</h1>
                <p class="audit-subtitle">Real-time operational intelligence for Klinik management</p>
                <div
                    style="background:var(--glass);border:1px solid var(--card-border);border-radius:14px;padding:20px;margin-bottom:28px;text-align:left">
                    <div class="d-flex align-items-start gap-3 mb-3">
                        <div
                            style="width:36px;height:36px;border-radius:10px;background:rgba(15,118,110,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                            <i class="fas fa-chart-line" style="color:var(--primary-light)"></i>
                        </div>
                        <div>
                            <div style="font-weight:600;font-size:0.9rem;color:#f1f5f9">Live Metrics</div>
                            <div style="font-size:0.78rem;color:#64748b">Inventory, roster & promo data in real-time
                            </div>
                        </div>
                    </div>
                    <div class="d-flex align-items-start gap-3 mb-3">
                        <div
                            style="width:36px;height:36px;border-radius:10px;background:rgba(99,102,241,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                            <i class="fas fa-shield-alt" style="color:#818cf8"></i>
                        </div>
                        <div>
                            <div style="font-weight:600;font-size:0.9rem;color:#f1f5f9">Secure Access</div>
                            <div style="font-size:0.78rem;color:#64748b">SHA-256 encrypted authentication</div>
                        </div>
                    </div>
                    <div class="d-flex align-items-start gap-3">
                        <div
                            style="width:36px;height:36px;border-radius:10px;background:rgba(244,63,94,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                            <i class="fas fa-cogs" style="color:#fb7185"></i>
                        </div>
                        <div>
                            <div style="font-weight:600;font-size:0.9rem;color:#f1f5f9">Full Dashboard</div>
                            <div style="font-size:0.78rem;color:#64748b">Manage inventory, roster & promotions</div>
                        </div>
                    </div>
                </div>
                <button class="audit-btn" onclick="goToStep(2)"><span>Begin Audit</span><i
                        class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <!-- Step 2: Authenticate -->
        <div class="audit-step" id="step2">
            <div class="audit-card">
                <div class="step-dots"><span class="step-dot done"></span><span class="step-dot active"></span><span
                        class="step-dot"></span></div>
                <div class="audit-logo"><i class="fas fa-lock"></i></div>
                <h2 class="audit-title" style="font-size:1.4rem">Authenticate</h2>
                <p class="audit-subtitle">Verify your identity to access the audit</p>
                <div class="d-flex flex-column gap-3 mb-4">
                    <input type="email" class="audit-input" id="adminEmailInput" placeholder="Admin Email"
                        autocomplete="email">
                    <input type="password" class="audit-input" id="adminPasswordInput" placeholder="Password"
                        autocomplete="current-password">
                </div>
                <button class="audit-btn" id="loginBtn" onclick="verifyAdminLogin()"><i
                        class="fas fa-fingerprint"></i><span>Access Dashboard</span></button>
                <p class="login-error" id="loginError">Invalid credentials</p>
                <div style="text-align:center;margin-top:16px"><button
                        style="background:none;border:none;color:#475569;font-size:0.8rem;cursor:pointer"
                        onclick="goToStep(1)"><i class="fas fa-arrow-left me-1"></i>Back</button></div>
            </div>
        </div>

        <!-- Step 3: Live Metrics -->
        <div class="audit-step" id="step3">
            <div class="audit-card">
                <div class="step-dots"><span class="step-dot done"></span><span class="step-dot done"></span><span
                        class="step-dot active"></span></div>
                <h2 class="audit-title" style="font-size:1.4rem">Live Clinic Metrics</h2>
                <p class="audit-subtitle">Pulling real-time data from your systems...</p>
                <div class="row g-3 mb-4">
                    <div class="col-6">
                        <div class="metric-card">
                            <div class="metric-icon" style="background:rgba(15,118,110,0.15)"><i class="fas fa-boxes"
                                    style="color:var(--primary-light)"></i></div>
                            <div class="metric-value" id="metricInventory">‚Äî</div>
                            <div class="metric-label">Stock Items</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="metric-card">
                            <div class="metric-icon" style="background:rgba(99,102,241,0.15)"><i
                                    class="fas fa-calendar-check" style="color:#818cf8"></i></div>
                            <div class="metric-value" id="metricRoster">‚Äî</div>
                            <div class="metric-label">Roster Rules</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="metric-card">
                            <div class="metric-icon" style="background:rgba(244,63,94,0.15)"><i class="fas fa-user-md"
                                    style="color:#fb7185"></i></div>
                            <div class="metric-value" id="metricDoctors">‚Äî</div>
                            <div class="metric-label">Doctors</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="metric-card">
                            <div class="metric-icon" style="background:rgba(251,191,36,0.15)"><i class="fas fa-bullhorn"
                                    style="color:#fbbf24"></i></div>
                            <div class="metric-value" id="metricPromo">‚Äî</div>
                            <div class="metric-label">Promo Status</div>
                        </div>
                    </div>
                </div>
                <button class="audit-btn" id="btnContinue" onclick="goToStep(4)" disabled><i
                        class="fas fa-spinner fa-spin" id="scanIcon"></i><span id="scanText">Scanning
                        systems...</span></button>
            </div>
        </div>

        <!-- Step 4: Dashboard -->
        <div class="audit-step" id="step4" style="max-width:960px">
            <div class="dash-header">
                <div class="d-flex align-items-center gap-3">
                    <div class="audit-logo" style="width:40px;height:40px;border-radius:12px;font-size:1rem;margin:0"><i
                            class="fas fa-plus"></i></div>
                    <div><span class="dash-title">Admin Dashboard</span>
                        <div style="font-size:0.75rem;color:#64748b">Klinik Efficiency Audit</div>
                    </div>
                </div>
                <button class="dash-logout" onclick="location.reload()"><i class="fas fa-sign-out-alt me-1"></i>Log
                    Out</button>
            </div>
            <!-- Firebase Usage -->
            <div id="firebaseUsageAlerts" class="mb-3"></div>
            <!-- Tabs -->
            <div class="dash-tabs" id="dashTabs">
                <button class="dash-tab" onclick="switchTab('analytics',this)">üìä Analytics</button>
                <button class="dash-tab active" onclick="switchTab('inventory',this)">üì¶ Inventory</button>
                <button class="dash-tab" onclick="switchTab('roster',this)">üìÖ Roster</button>
                <button class="dash-tab" onclick="switchTab('promo',this)">üéâ Promo</button>
                <button class="dash-tab" onclick="switchTab('cashflow',this)">üí∞ Cash Flow</button>
                <button class="dash-tab" onclick="switchTab('settings',this)">‚öôÔ∏è Settings</button>
                <button class="dash-tab" id="tabAdmin" onclick="switchTab('admin',this)" style="display:none">üîê
                    Admin</button>
            </div>
            <!-- Inventory Pane -->
            <div class="dash-pane active" id="paneInventory">
                <div class="dash-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="fw-bold small text-uppercase mb-0" style="color:var(--primary-light)">Stock
                            Management</h6>
                        <button onclick="toggleInventoryForm()" class="btn btn-primary btn-sm rounded-pill px-3"><i
                                class="fas fa-plus me-1"></i>Add Item</button>
                    </div>
                    <div class="d-flex gap-2 flex-wrap mb-3">
                        <input type="text" id="invSearch" class="form-control form-control-sm"
                            placeholder="Search item..." onkeyup="filterInventory()" style="min-width:120px;flex:1;">
                        <select id="invFilterCategory" class="form-select form-select-sm" style="width:auto;"
                            onchange="filterInventory()">
                            <option value="All">All Categories</option>
                            <option value="Medicine">Medicine</option>
                            <option value="Supplements">Supplements</option>
                            <option value="Equipment">Equipment</option>
                            <option value="Stationery">Stationery</option>
                            <option value="Others">Others</option>
                        </select>
                        <select id="invSortBy" class="form-select form-select-sm" style="width:auto;"
                            onchange="setInventorySort(this.value)">
                            <option value="name" selected>Sort: Name</option>
                            <option value="category">Sort: Category</option>
                            <option value="stock">Sort: Stock ‚Üë</option>
                            <option value="stock-desc">Sort: Stock ‚Üì</option>
                            <option value="expiry">Sort: Expiry</option>
                        </select>
                    </div>
                    <div id="inventoryForm" class="p-3 rounded mb-3 border"
                        style="display:none;background:rgba(255,255,255,0.03)">
                        <h6 class="fw-bold mb-2">New Stock Item</h6>
                        <div class="mb-2">
                            <select id="invCategory" class="form-select form-select-sm mb-2">
                                <option value="Medicine">Medicine</option>
                                <option value="Supplements">Supplements</option>
                                <option value="Equipment">Equipment</option>
                                <option value="Stationery">Stationery</option>
                                <option value="Others">Others</option>
                            </select>
                            <input type="text" id="invName" class="form-control form-control-sm"
                                placeholder="Item Name">
                        </div>
                        <div class="row g-2 mb-2">
                            <div class="col-6"><input type="number" id="invQty" class="form-control form-control-sm"
                                    placeholder="Qty"></div>
                            <div class="col-6"><input type="date" id="invExpiry"
                                    class="form-control form-control-sm"><small class="text-muted"
                                    style="font-size:0.7rem">Expiry (Optional)</small></div>
                        </div>
                        <div class="d-flex gap-2">
                            <button onclick="addInventoryItem()"
                                class="btn btn-success btn-sm flex-grow-1">Save</button>
                            <button onclick="toggleInventoryForm()"
                                class="btn btn-outline-secondary btn-sm">Cancel</button>
                        </div>
                    </div>
                    <div class="table-responsive border rounded" style="max-height:50vh">
                        <table class="table table-hover mb-0 align-middle" style="font-size:0.85rem">
                            <thead class="table-light sticky-top">
                                <tr>
                                    <th style="width:40%">Item</th>
                                    <th style="width:20%">Category</th>
                                    <th style="width:30%">Stock</th>
                                    <th style="width:10%"></th>
                                </tr>
                            </thead>
                            <tbody id="inventoryList"></tbody>
                        </table>
                        <div id="inventoryEmpty" class="text-center p-4 text-muted" style="display:none"><i
                                class="fas fa-box-open fs-1 mb-2" style="color:#475569"></i><br>No items found.</div>
                    </div>
                </div>
            </div>
            <!-- Roster Pane -->
            <div class="dash-pane" id="paneRoster">
                <div class="dash-card">
                    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="adminRosterView" id="viewWeekly"
                                autocomplete="off" checked onchange="switchAdminRosterView('weekly')">
                            <label class="btn btn-outline-primary btn-sm" for="viewWeekly">Weekly</label>
                            <input type="radio" class="btn-check" name="adminRosterView" id="viewMonthly"
                                autocomplete="off" onchange="switchAdminRosterView('monthly')">
                            <label class="btn btn-outline-primary btn-sm" for="viewMonthly">Monthly</label>
                        </div>
                        <button onclick="toggleRosterForm()" class="btn btn-primary btn-sm rounded-pill px-3"><i
                                class="fas fa-plus me-1"></i>Add Rule</button>
                    </div>
                    <div id="adminWeeklyOverview" class="mb-3"></div>
                    <div id="adminMonthlyOverview" class="mb-3" style="display:none">
                        <div class="d-flex justify-content-between align-items-center mb-2 p-2 border rounded">
                            <button class="btn btn-sm btn-outline-secondary" onclick="changeAdminRosterMonth(-1)"><i
                                    class="fas fa-chevron-left"></i></button>
                            <span id="adminRosterMonthLabel" class="fw-bold" style="font-size:0.9rem"></span>
                            <button class="btn btn-sm btn-outline-secondary" onclick="changeAdminRosterMonth(1)"><i
                                    class="fas fa-chevron-right"></i></button>
                        </div>
                        <div id="adminRosterCalendar" class="roster-calendar-container"></div>
                    </div>
                    <div id="rosterForm" class="p-3 rounded mb-3 border"
                        style="display:none;background:rgba(255,255,255,0.03)">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="fw-bold mb-0">New Schedule Rule</h6>
                            <button type="button" class="btn-close btn-close-white"
                                onclick="toggleRosterForm()"></button>
                        </div>
                        <div class="btn-group w-100 mb-2" role="group">
                            <input type="radio" class="btn-check" name="ruleType" id="ruleDate" value="date" checked
                                onchange="toggleRuleInputs()"><label class="btn btn-outline-primary btn-sm"
                                for="ruleDate">Specific Date</label>
                            <input type="radio" class="btn-check" name="ruleType" id="ruleWeekly" value="weekly"
                                onchange="toggleRuleInputs()"><label class="btn btn-outline-primary btn-sm"
                                for="ruleWeekly">Weekly</label>
                        </div>
                        <div class="mb-2">
                            <div id="inputDateGroup">
                                <div class="row g-2">
                                    <div class="col-6"><label class="small text-muted">From</label><input type="date"
                                            id="rosterDateStart" class="form-control form-control-sm"></div>
                                    <div class="col-6"><label class="small text-muted">To (Optional)</label><input
                                            type="date" id="rosterDateEnd" class="form-control form-control-sm"></div>
                                </div>
                                <div class="form-text" style="font-size:0.75rem;color:#64748b">Leave "To" empty for
                                    single day.</div>
                            </div>
                            <div id="inputDayGroup" style="display:none"><label class="small text-muted">Day of
                                    Week</label><select id="rosterDay" class="form-select form-select-sm">
                                    <option value="1">Monday</option>
                                    <option value="2">Tuesday</option>
                                    <option value="3">Wednesday</option>
                                    <option value="4">Thursday</option>
                                    <option value="5">Friday</option>
                                    <option value="6">Saturday</option>
                                    <option value="0">Sunday</option>
                                </select></div>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-7"><label class="small text-muted">Doctor</label><select
                                    id="rosterDocSelect" class="form-select form-select-sm"></select></div>
                            <div class="col-5"><label class="small text-muted">Shift</label><select id="rosterShift"
                                    class="form-select form-select-sm">
                                    <option value="Full Day">Full Day</option>
                                    <option value="Morning">Morning</option>
                                    <option value="Evening">Evening</option>
                                    <option value="Off">OFF / Closed</option>
                                </select></div>
                        </div>
                        <div class="d-flex gap-2"><button onclick="addRosterRule()"
                                class="btn btn-success btn-sm flex-grow-1">Save Rule</button><button
                                onclick="toggleRosterForm()" class="btn btn-outline-secondary btn-sm">Cancel</button>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <button onclick="deleteSelectedRules()" id="btnDeleteSelected" class="btn btn-danger btn-sm"
                            disabled><i class="fas fa-trash me-1"></i>Delete Selected</button>
                        <button onclick="clearAllRules()" class="btn btn-outline-danger btn-sm"><i
                                class="fas fa-bomb me-1"></i>Clear All</button>
                    </div>
                    <div class="table-responsive border rounded" style="max-height:50vh">
                        <table class="table table-hover mb-0 align-middle" style="font-size:0.85rem">
                            <thead class="table-light sticky-top">
                                <tr>
                                    <th style="width:40px" class="text-center"><input type="checkbox"
                                            id="selectAllRules" class="form-check-input"
                                            onchange="toggleAllRules(this)"></th>
                                    <th>When</th>
                                    <th>Doctor</th>
                                    <th class="text-end">Action</th>
                                </tr>
                            </thead>
                            <tbody id="rosterList"></tbody>
                        </table>
                        <div id="rosterEmpty" class="text-center p-4 text-muted" style="display:none"><i
                                class="fas fa-calendar-times fs-1 mb-2" style="color:#475569"></i><br>No custom rules
                            set.</div>
                    </div>
                    <div class="p-3 rounded border mt-3" style="background:rgba(255,255,255,0.03)">
                        <h6 class="fw-bold mb-2 small text-uppercase" style="color:var(--primary-light)"><i
                                class="fas fa-user-md me-1"></i>Manage Doctors</h6>
                        <div class="d-flex gap-2 mb-2">
                            <input type="text" id="newDoctorName" class="form-control form-control-sm"
                                placeholder="e.g. Dr. Ahmad (Surgeon)">
                            <button onclick="addDoctor()" class="btn btn-success btn-sm text-nowrap"><i
                                    class="fas fa-plus me-1"></i>Add</button>
                        </div>
                        <div id="doctorManageList" class="border rounded" style="max-height:200px;overflow-y:auto">
                        </div>
                    </div>
                </div>
            </div>
            <!-- Promo Pane -->
            <div class="dash-pane" id="panePromo">
                <div class="dash-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="fw-bold small text-uppercase mb-0" style="color:var(--primary-light)">Promo Section
                        </h6>
                        <div class="form-check form-switch"><input class="form-check-input" type="checkbox"
                                id="promoToggle" onchange="togglePromoSection()"><label class="form-check-label small"
                                for="promoToggle" style="color:#94a3b8">Show on Site</label></div>
                    </div>
                    <div class="p-3 rounded mb-3 border" style="background:rgba(255,255,255,0.03)">
                        <h6 class="fw-bold mb-2 small">Add Promo Item</h6>
                        <div class="mb-2"><input type="text" id="promoImageUrl" class="form-control form-control-sm"
                                placeholder="Image URL (e.g. https://...)" oninput="previewPromoImage()"></div>
                        <div class="mb-2"><label class="btn btn-outline-secondary btn-sm w-100"><i
                                    class="fas fa-upload me-1"></i>Upload from Device<input type="file" accept="image/*"
                                    style="display:none" onchange="handlePromoFileUpload(this)"></label></div>
                        <div id="promoImagePreview" class="mb-2 text-center p-2 border rounded" style="min-height:60px">
                            <span class="text-muted small">Enter a URL or upload an image</span>
                        </div>
                        <div class="mb-2"><input type="text" id="promoText" class="form-control form-control-sm"
                                placeholder="Caption (optional)"></div>
                        <button onclick="addPromoItem()" class="btn btn-success btn-sm w-100"><i
                                class="fas fa-plus me-1"></i>Add Promo</button>
                    </div>
                    <div id="promoItemList" class="border rounded p-2" style="max-height:40vh;overflow-y:auto"></div>
                </div>
            </div>
            <!-- Analytics Pane -->
            <div class="dash-pane" id="paneAnalytics">
                <div class="dash-card">
                    <h6 class="fw-bold small text-uppercase mb-3" style="color:var(--primary-light)"><i
                            class="fas fa-chart-line me-1"></i>Clinic Overview</h6>
                    <div id="analyticsContent">
                        <div class="text-center p-4" style="color:#64748b"><i
                                class="fas fa-spinner fa-spin me-1"></i>Loading analytics...</div>
                    </div>
                </div>
            </div>
            <!-- Cash Flow Pane -->
            <div class="dash-pane" id="paneCashflow">
                <div class="dash-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="fw-bold small text-uppercase mb-0" style="color:var(--primary-light)"><i
                                class="fas fa-exchange-alt me-1"></i>Cash Flow Tracker</h6>
                        <button onclick="toggleCashFlowForm()" class="btn btn-primary btn-sm rounded-pill px-3"><i
                                class="fas fa-plus me-1"></i>Add Transaction</button>
                    </div>
                    <!-- Add Transaction Form -->
                    <div id="cfForm" class="p-3 rounded mb-3 border"
                        style="display:none;background:rgba(255,255,255,0.03)">
                        <h6 class="fw-bold mb-2">New Transaction</h6>
                        <!-- Type Toggle -->
                        <div class="btn-group w-100 mb-2" role="group">
                            <input type="radio" class="btn-check" name="cfType" id="cfTypeIncome" value="income"
                                onchange="updateCFCategories()">
                            <label class="btn btn-outline-success btn-sm" for="cfTypeIncome"><i
                                    class="fas fa-arrow-up me-1"></i>Income</label>
                            <input type="radio" class="btn-check" name="cfType" id="cfTypeExpense" value="expense"
                                checked onchange="updateCFCategories()">
                            <label class="btn btn-outline-danger btn-sm" for="cfTypeExpense"><i
                                    class="fas fa-arrow-down me-1"></i>Expense</label>
                        </div>
                        <div class="row g-2 mb-2">
                            <div class="col-6"><input type="date" id="cfDate" class="form-control form-control-sm">
                            </div>
                            <div class="col-6">
                                <select id="cfCategory" class="form-select form-select-sm">
                                    <option value="Supplies">Supplies</option>
                                    <option value="Utilities">Utilities</option>
                                    <option value="Payroll">Payroll</option>
                                    <option value="Maintenance">Maintenance</option>
                                    <option value="Equipment">Equipment</option>
                                    <option value="Others">Others</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-2"><input type="text" id="cfDesc" class="form-control form-control-sm"
                                placeholder="Description"></div>
                        <div class="mb-2"><input type="number" id="cfAmount" class="form-control form-control-sm"
                                placeholder="Amount (RM)" step="0.01" min="0"></div>
                        <div class="d-flex gap-2">
                            <button onclick="addCashFlowEntry()"
                                class="btn btn-success btn-sm flex-grow-1">Save</button>
                            <button onclick="toggleCashFlowForm()"
                                class="btn btn-outline-secondary btn-sm">Cancel</button>
                        </div>
                    </div>
                    <!-- Summary Cards -->
                    <div id="cfSummary" class="mb-3"></div>
                    <!-- Filters -->
                    <div class="d-flex gap-2 flex-wrap mb-3 align-items-center">
                        <select id="cfFilterMonth" class="form-select form-select-sm" style="width:auto;"
                            onchange="renderCashFlow()">
                            <option value="all">All Months</option>
                        </select>
                        <select id="cfFilterType" class="form-select form-select-sm" style="width:auto;"
                            onchange="renderCashFlow()">
                            <option value="all">All Types</option>
                            <option value="income">Income Only</option>
                            <option value="expense">Expense Only</option>
                        </select>
                        <select id="cfFilterCategory" class="form-select form-select-sm" style="width:auto;"
                            onchange="renderCashFlow()">
                            <option value="All">All Categories</option>
                        </select>
                        <button onclick="deleteSelectedCF()" id="btnDeleteSelectedCF"
                            class="btn btn-danger btn-sm ms-auto" disabled><i class="fas fa-trash me-1"></i>Delete
                            Selected</button>
                    </div>
                    <!-- Transaction Table -->
                    <div class="table-responsive border rounded" style="max-height:50vh">
                        <table class="table table-hover mb-0 align-middle" style="font-size:0.85rem">
                            <thead class="table-light sticky-top">
                                <tr>
                                    <th style="width:40px" class="text-center"><input type="checkbox" id="selectAllCF"
                                            class="form-check-input" onchange="toggleAllCF(this)"></th>
                                    <th style="width:13%">Date</th>
                                    <th style="width:10%">Type</th>
                                    <th style="width:25%">Description</th>
                                    <th style="width:15%">Category</th>
                                    <th style="width:15%" class="text-end">Amount</th>
                                    <th style="width:7%"></th>
                                </tr>
                            </thead>
                            <tbody id="cfList"></tbody>
                        </table>
                        <div id="cfEmpty" class="text-center p-4 text-muted" style="display:none"><i
                                class="fas fa-exchange-alt fs-1 mb-2" style="color:#475569"></i><br>No transactions
                            recorded.</div>
                    </div>
                </div>
            </div>
            <!-- Settings Pane -->
            <div class="dash-pane" id="paneSettings">
                <div class="dash-card">
                    <h6 class="fw-bold small text-uppercase mb-3" style="color:var(--primary-light)"><i
                            class="fas fa-cog me-1"></i>Clinic Settings</h6>
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="small text-muted mb-1">Clinic Name</label>
                            <input type="text" id="setClinicName" class="form-control form-control-sm"
                                placeholder="e.g. Klinik Haya">
                        </div>
                        <div class="col-12">
                            <label class="small text-muted mb-1">Address</label>
                            <textarea id="setAddress" class="form-control form-control-sm" rows="2"
                                placeholder="Full address"></textarea>
                        </div>
                        <div class="col-6">
                            <label class="small text-muted mb-1">Phone</label>
                            <input type="tel" id="setPhone" class="form-control form-control-sm"
                                placeholder="e.g. 03-1234 5678">
                        </div>
                        <div class="col-6">
                            <label class="small text-muted mb-1">Email</label>
                            <input type="email" id="setEmail" class="form-control form-control-sm"
                                placeholder="e.g. info@klinik.com">
                        </div>
                        <div class="col-12">
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="set247" onchange="toggle247()">
                                <label class="form-check-label small text-muted" for="set247">Open 24/7 (No specific
                                    hours)</label>
                            </div>
                        </div>
                        <div id="hoursInputs">
                            <div class="row g-3">
                                <div class="col-6">
                                    <label class="small text-muted mb-1">Weekday Hours</label>
                                    <input type="text" id="setHoursWeekday" class="form-control form-control-sm"
                                        placeholder="e.g. 8:00 AM ‚Äì 10:00 PM">
                                </div>
                                <div class="col-6">
                                    <label class="small text-muted mb-1">Weekend Hours</label>
                                    <input type="text" id="setHoursWeekend" class="form-control form-control-sm"
                                        placeholder="e.g. 9:00 AM ‚Äì 5:00 PM">
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr style="border-color:rgba(255,255,255,0.08);margin:20px 0">
                    <h6 class="fw-bold small text-uppercase mb-3" style="color:var(--primary-light)"><i
                            class="fas fa-share-alt me-1"></i>Social Links</h6>
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="small text-muted mb-1"><i class="fab fa-whatsapp me-1"
                                    style="color:#25d366"></i>WhatsApp Number</label>
                            <input type="text" id="setWhatsApp" class="form-control form-control-sm"
                                placeholder="e.g. 60123456789">
                        </div>
                        <div class="col-6">
                            <label class="small text-muted mb-1"><i class="fab fa-facebook me-1"
                                    style="color:#1877f2"></i>Facebook URL</label>
                            <input type="url" id="setFacebook" class="form-control form-control-sm"
                                placeholder="https://facebook.com/...">
                        </div>
                        <div class="col-6">
                            <label class="small text-muted mb-1"><i class="fab fa-instagram me-1"
                                    style="color:#e4405f"></i>Instagram URL</label>
                            <input type="url" id="setInstagram" class="form-control form-control-sm"
                                placeholder="https://instagram.com/...">
                        </div>
                        <div class="col-6">
                            <label class="small text-muted mb-1"><i class="fab fa-tiktok me-1"
                                    style="color:#ff0050"></i>TikTok URL</label>
                            <input type="url" id="setTikTok" class="form-control form-control-sm"
                                placeholder="https://tiktok.com/@...">
                        </div>
                        <div class="col-6">
                            <label class="small text-muted mb-1"><i class="fas fa-at me-1"
                                    style="color:#ffffff"></i>Threads URL</label>
                            <input type="url" id="setThreads" class="form-control form-control-sm"
                                placeholder="https://threads.net/@...">
                        </div>
                    </div>
                    <hr style="border-color:rgba(255,255,255,0.08);margin:20px 0">
                    <h6 class="fw-bold small text-uppercase mb-3" style="color:var(--primary-light)"><i
                            class="fas fa-map-marker-alt me-1"></i>Google Maps</h6>
                    <div class="mb-3">
                        <label class="small text-muted mb-1">Embed URL</label>
                        <input type="url" id="setMapEmbed" class="form-control form-control-sm"
                            placeholder="https://www.google.com/maps/embed?pb=...">
                        <div class="mt-1" style="font-size:0.7rem;color:#64748b">
                            <i class="fas fa-info-circle me-1" style="color:#818cf8"></i>
                            <strong>How to get the embed URL:</strong><br>
                            1. Go to <a href="https://maps.google.com" target="_blank" style="color:#14b8a6">Google
                                Maps</a> ‚Üí search your clinic<br>
                            2. Click <strong>Share</strong> ‚Üí <strong>Embed a map</strong> tab<br>
                            3. Copy <strong>only the URL</strong> inside <code>src="..."</code> (starts with
                            <code>https://www.google.com/maps/embed</code>)<br>
                            ‚ö†Ô∏è Do NOT paste the full <code>&lt;iframe&gt;</code> tag ‚Äî only the URL
                        </div>
                        <button type="button" onclick="testMapEmbed()"
                            class="btn btn-outline-info btn-sm mt-2 rounded-pill px-3">
                            <i class="fas fa-eye me-1"></i>Test Map Preview
                        </button>
                        <div id="mapPreviewStatus" class="mt-2" style="font-size:0.8rem"></div>
                        <div id="mapPreviewContainer" class="mt-2 rounded border overflow-hidden" style="display:none">
                            <iframe id="mapPreviewIframe" width="100%" height="180" style="border:0"
                                loading="lazy"></iframe>
                        </div>
                    </div>
                    <div class="d-flex gap-2 mt-3">
                        <button onclick="saveSettings()" class="btn btn-success btn-sm flex-grow-1"><i
                                class="fas fa-save me-1"></i>Save Settings</button>
                        <button onclick="loadSettings()" class="btn btn-outline-secondary btn-sm"><i
                                class="fas fa-sync me-1"></i>Reset</button>
                    </div>
                    <div id="settingsSaveStatus" class="text-center mt-2" style="font-size:0.8rem"></div>
                    <hr style="border-color:rgba(255,255,255,0.08);margin:20px 0">
                    <h6 class="fw-bold small text-uppercase mb-3" style="color:var(--primary-light)"><i
                            class="fas fa-key me-1"></i>Owner PIN</h6>
                    <p class="small" style="color:#94a3b8">Set a PIN to protect delete operations. Staff must enter this
                        PIN before deleting any data.</p>
                    <button onclick="setOwnerPin()" class="btn btn-outline-warning btn-sm rounded-pill px-3"><i
                            class="fas fa-lock me-1"></i>Set / Change Owner PIN</button>
                </div>
            </div>

            <!-- Admin Pane (Owner-Only) -->
            <div class="dash-pane" id="paneAdmin">
                <div class="dash-card">
                    <!-- PIN Gate -->
                    <div id="adminPinGate" class="text-center py-5">
                        <div class="admin-lock-icon mb-3">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h6 class="fw-bold mb-2" style="color:#f1f5f9">Owner Access Required</h6>
                        <p class="small mb-4" style="color:#94a3b8;max-width:320px;margin:0 auto">This section is
                            restricted to the clinic owner. Enter your Owner PIN to access admin settings.</p>
                        <button onclick="unlockAdminTab()" class="btn btn-outline-warning btn-sm rounded-pill px-4">
                            <i class="fas fa-key me-1"></i>Enter Owner PIN</button>
                    </div>
                    <!-- Admin Content (hidden until PIN verified) -->
                    <div id="adminContent" style="display:none">
                        <h6 class="fw-bold small text-uppercase mb-3" style="color:var(--primary-light)">
                            <i class="fas fa-user-cog me-1"></i>Admin Credentials
                        </h6>
                        <p class="small mb-3" style="color:#94a3b8">Manage the admin login email and password used to
                            access this dashboard.</p>
                        <div id="adminCredInfo"></div>
                        <div class="d-flex gap-2 flex-wrap mt-3">
                            <button onclick="changeAdminEmail()"
                                class="btn btn-outline-primary btn-sm rounded-pill px-3">
                                <i class="fas fa-envelope me-1"></i>Change Email</button>
                            <button onclick="changeAdminPassword()"
                                class="btn btn-outline-warning btn-sm rounded-pill px-3">
                                <i class="fas fa-key me-1"></i>Change Password</button>
                        </div>
                        <div class="mt-4 p-3 rounded border"
                            style="background:rgba(251,113,133,0.05);border-color:rgba(251,113,133,0.15)!important">
                            <p class="small mb-0" style="color:#fb7185"><i
                                    class="fas fa-exclamation-triangle me-1"></i><strong>Important:</strong> Changing
                                the password here will require the new password for future logins. Make sure to remember
                                it.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Owner PIN Modal -->
    <div id="ownerPinModal" class="pin-modal-overlay" style="display:none">
        <div class="pin-modal-card">
            <div class="pin-modal-icon"><i class="fas fa-lock"></i></div>
            <h6 class="fw-bold mb-1" style="color:#f1f5f9">Owner PIN Required</h6>
            <p class="small mb-3" style="color:#94a3b8">Enter the owner PIN to confirm this action.</p>
            <input type="password" id="ownerPinInput" class="audit-input mb-2" placeholder="Enter PIN"
                autocomplete="off" maxlength="8" inputmode="numeric">
            <p id="ownerPinError" class="small mb-2" style="color:#fb7185;display:none">Incorrect PIN</p>
            <div class="d-flex gap-2">
                <button onclick="verifyOwnerPin()" class="btn btn-success btn-sm flex-grow-1"><i
                        class="fas fa-check me-1"></i>Verify</button>
                <button onclick="hidePinModal()" class="btn btn-outline-secondary btn-sm">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="admin.js"></script>
</body>

</html>