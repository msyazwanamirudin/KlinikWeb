<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinic Efficiency Audit | Klinik</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&family=Space+Grotesk:wght@500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="admin.css">
</head>

<body>
    <canvas id="particleCanvas"></canvas>
    <div class="audit-bg"></div>
    <!-- Progress Bar -->
    <div class="audit-progress">
        <div class="audit-progress-fill" id="progressFill" style="width:25%"></div>
    </div>

    <div class="audit-container" id="auditContainer">
        <!-- Step 1: Welcome -->
        <div class="audit-step active" id="step1">
            <div class="audit-card text-center">
                <div class="step-dots"><span class="step-dot active"></span><span class="step-dot"></span><span
                        class="step-dot"></span></div>
                <div class="audit-logo" style="position:relative">
                    <div class="pulse-ring"></div>
                    <i class="fas fa-plus"></i>
                </div>
                <h1 class="audit-title">Clinic Efficiency Audit</h1>
                <p class="audit-subtitle">Real-time operational intelligence for Klinik management</p>
                <div
                    style="background:var(--glass);border:1px solid var(--card-border);border-radius:14px;padding:20px;margin-bottom:28px;text-align:left">
                    <div class="d-flex align-items-start gap-3 mb-3">
                        <div
                            style="width:36px;height:36px;border-radius:10px;background:rgba(15,118,110,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                            <i class="fas fa-chart-line" style="color:var(--primary-light)"></i>
                        </div>
                        <div>
                            <div style="font-weight:600;font-size:0.9rem;color:#f1f5f9">Live Metrics</div>
                            <div style="font-size:0.78rem;color:#64748b">Inventory, roster & promo data in real-time
                            </div>
                        </div>
                    </div>
                    <div class="d-flex align-items-start gap-3 mb-3">
                        <div
                            style="width:36px;height:36px;border-radius:10px;background:rgba(99,102,241,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                            <i class="fas fa-shield-alt" style="color:#818cf8"></i>
                        </div>
                        <div>
                            <div style="font-weight:600;font-size:0.9rem;color:#f1f5f9">Secure Access</div>
                            <div style="font-size:0.78rem;color:#64748b">SHA-256 encrypted authentication</div>
                        </div>
                    </div>
                    <div class="d-flex align-items-start gap-3">
                        <div
                            style="width:36px;height:36px;border-radius:10px;background:rgba(244,63,94,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                            <i class="fas fa-cogs" style="color:#fb7185"></i>
                        </div>
                        <div>
                            <div style="font-weight:600;font-size:0.9rem;color:#f1f5f9">Full Dashboard</div>
                            <div style="font-size:0.78rem;color:#64748b">Manage inventory, roster & promotions</div>
                        </div>
                    </div>
                </div>
                <button class="audit-btn" onclick="goToStep(2)"><span>Begin Audit</span><i
                        class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <!-- Step 2: Authenticate -->
        <div class="audit-step" id="step2">
            <div class="audit-card">
                <div class="step-dots"><span class="step-dot done"></span><span class="step-dot active"></span><span
                        class="step-dot"></span></div>
                <div class="audit-logo"><i class="fas fa-lock"></i></div>
                <h2 class="audit-title" style="font-size:1.4rem">Authenticate</h2>
                <p class="audit-subtitle">Verify your identity to access the audit</p>
                <div class="d-flex flex-column gap-3 mb-4">
                    <input type="email" class="audit-input" id="adminEmailInput" placeholder="Admin Email"
                        autocomplete="email">
                    <input type="password" class="audit-input" id="adminPasswordInput" placeholder="Password"
                        autocomplete="current-password">
                </div>
                <button class="audit-btn" id="loginBtn" onclick="verifyAdminLogin()"><i
                        class="fas fa-fingerprint"></i><span>Access Dashboard</span></button>
                <p class="login-error" id="loginError">Invalid credentials</p>
                <div style="text-align:center;margin-top:16px"><button
                        style="background:none;border:none;color:#475569;font-size:0.8rem;cursor:pointer"
                        onclick="goToStep(1)"><i class="fas fa-arrow-left me-1"></i>Back</button></div>
            </div>
        </div>

        <!-- Step 3: Live Metrics -->
        <div class="audit-step" id="step3">
            <div class="audit-card">
                <div class="step-dots"><span class="step-dot done"></span><span class="step-dot done"></span><span
                        class="step-dot active"></span></div>
                <h2 class="audit-title" style="font-size:1.4rem">Live Clinic Metrics</h2>
                <p class="audit-subtitle">Pulling real-time data from your systems...</p>
                <div class="row g-3 mb-4">
                    <div class="col-6">
                        <div class="metric-card">
                            <div class="metric-icon" style="background:rgba(15,118,110,0.15)"><i class="fas fa-boxes"
                                    style="color:var(--primary-light)"></i></div>
                            <div class="metric-value" id="metricInventory">â€”</div>
                            <div class="metric-label">Stock Items</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="metric-card">
                            <div class="metric-icon" style="background:rgba(99,102,241,0.15)"><i
                                    class="fas fa-calendar-check" style="color:#818cf8"></i></div>
                            <div class="metric-value" id="metricRoster">â€”</div>
                            <div class="metric-label">Roster Rules</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="metric-card">
                            <div class="metric-icon" style="background:rgba(244,63,94,0.15)"><i class="fas fa-user-md"
                                    style="color:#fb7185"></i></div>
                            <div class="metric-value" id="metricDoctors">â€”</div>
                            <div class="metric-label">Doctors</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="metric-card">
                            <div class="metric-icon" style="background:rgba(251,191,36,0.15)"><i class="fas fa-bullhorn"
                                    style="color:#fbbf24"></i></div>
                            <div class="metric-value" id="metricPromo">â€”</div>
                            <div class="metric-label">Promo Status</div>
                        </div>
                    </div>
                </div>
                <button class="audit-btn" id="btnContinue" onclick="goToStep(4)" disabled><i
                        class="fas fa-spinner fa-spin" id="scanIcon"></i><span id="scanText">Scanning
                        systems...</span></button>
            </div>
        </div>

        <!-- Step 4: Dashboard -->
        <div class="audit-step" id="step4" style="max-width:960px">
            <div class="dash-header">
                <div class="d-flex align-items-center gap-3">
                    <div class="audit-logo" style="width:40px;height:40px;border-radius:12px;font-size:1rem;margin:0"><i
                            class="fas fa-plus"></i></div>
                    <div><span class="dash-title">Admin Dashboard</span>
                        <div style="font-size:0.75rem;color:#64748b">Klinik Efficiency Audit</div>
                    </div>
                </div>
                <button class="dash-logout" onclick="location.reload()"><i class="fas fa-sign-out-alt me-1"></i>Log
                    Out</button>
            </div>
            <!-- Firebase Usage -->
            <div id="firebaseUsageAlerts" class="mb-3"></div>
            <!-- Tabs -->
            <div class="dash-tabs" id="dashTabs">
                <button class="dash-tab active" onclick="switchTab('inventory',this)">ðŸ“¦ Inventory</button>
                <button class="dash-tab" onclick="switchTab('roster',this)">ðŸ“… Roster</button>
                <button class="dash-tab" onclick="switchTab('promo',this)">ðŸŽ‰ Promo</button>
            </div>
            <!-- Inventory Pane -->
            <div class="dash-pane active" id="paneInventory">
                <div class="dash-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="fw-bold small text-uppercase mb-0" style="color:var(--primary-light)">Stock
                            Management</h6>
                        <button onclick="toggleInventoryForm()" class="btn btn-primary btn-sm rounded-pill px-3"><i
                                class="fas fa-plus me-1"></i>Add Item</button>
                    </div>
                    <div class="d-flex gap-2 flex-wrap mb-3">
                        <input type="text" id="invSearch" class="form-control form-control-sm"
                            placeholder="Search item..." onkeyup="filterInventory()" style="min-width:120px;flex:1;">
                        <select id="invFilterCategory" class="form-select form-select-sm" style="width:auto;"
                            onchange="filterInventory()">
                            <option value="All">All Categories</option>
                            <option value="Medicine">Medicine</option>
                            <option value="Supplements">Supplements</option>
                            <option value="Equipment">Equipment</option>
                            <option value="Stationery">Stationery</option>
                            <option value="Others">Others</option>
                        </select>
                        <select id="invSortBy" class="form-select form-select-sm" style="width:auto;"
                            onchange="setInventorySort(this.value)">
                            <option value="name" selected>Sort: Name</option>
                            <option value="category">Sort: Category</option>
                            <option value="stock">Sort: Stock â†‘</option>
                            <option value="stock-desc">Sort: Stock â†“</option>
                            <option value="expiry">Sort: Expiry</option>
                        </select>
                    </div>
                    <div id="inventoryForm" class="p-3 rounded mb-3 border"
                        style="display:none;background:rgba(255,255,255,0.03)">
                        <h6 class="fw-bold mb-2">New Stock Item</h6>
                        <div class="mb-2">
                            <select id="invCategory" class="form-select form-select-sm mb-2">
                                <option value="Medicine">Medicine</option>
                                <option value="Supplements">Supplements</option>
                                <option value="Equipment">Equipment</option>
                                <option value="Stationery">Stationery</option>
                                <option value="Others">Others</option>
                            </select>
                            <input type="text" id="invName" class="form-control form-control-sm"
                                placeholder="Item Name">
                        </div>
                        <div class="row g-2 mb-2">
                            <div class="col-6"><input type="number" id="invQty" class="form-control form-control-sm"
                                    placeholder="Qty"></div>
                            <div class="col-6"><input type="date" id="invExpiry"
                                    class="form-control form-control-sm"><small class="text-muted"
                                    style="font-size:0.7rem">Expiry (Optional)</small></div>
                        </div>
                        <div class="d-flex gap-2">
                            <button onclick="addInventoryItem()"
                                class="btn btn-success btn-sm flex-grow-1">Save</button>
                            <button onclick="toggleInventoryForm()"
                                class="btn btn-outline-secondary btn-sm">Cancel</button>
                        </div>
                    </div>
                    <div class="table-responsive border rounded" style="max-height:50vh">
                        <table class="table table-hover mb-0 align-middle" style="font-size:0.85rem">
                            <thead class="table-light sticky-top">
                                <tr>
                                    <th style="width:40%">Item</th>
                                    <th style="width:20%">Category</th>
                                    <th style="width:30%">Stock</th>
                                    <th style="width:10%"></th>
                                </tr>
                            </thead>
                            <tbody id="inventoryList"></tbody>
                        </table>
                        <div id="inventoryEmpty" class="text-center p-4 text-muted" style="display:none"><i
                                class="fas fa-box-open fs-1 mb-2" style="color:#475569"></i><br>No items found.</div>
                    </div>
                </div>
            </div>
            <!-- Roster Pane -->
            <div class="dash-pane" id="paneRoster">
                <div class="dash-card">
                    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="adminRosterView" id="viewWeekly"
                                autocomplete="off" checked onchange="switchAdminRosterView('weekly')">
                            <label class="btn btn-outline-primary btn-sm" for="viewWeekly">Weekly</label>
                            <input type="radio" class="btn-check" name="adminRosterView" id="viewMonthly"
                                autocomplete="off" onchange="switchAdminRosterView('monthly')">
                            <label class="btn btn-outline-primary btn-sm" for="viewMonthly">Monthly</label>
                        </div>
                        <button onclick="toggleRosterForm()" class="btn btn-primary btn-sm rounded-pill px-3"><i
                                class="fas fa-plus me-1"></i>Add Rule</button>
                    </div>
                    <div id="adminWeeklyOverview" class="mb-3"></div>
                    <div id="adminMonthlyOverview" class="mb-3" style="display:none">
                        <div class="d-flex justify-content-between align-items-center mb-2 p-2 border rounded">
                            <button class="btn btn-sm btn-outline-secondary" onclick="changeAdminRosterMonth(-1)"><i
                                    class="fas fa-chevron-left"></i></button>
                            <span id="adminRosterMonthLabel" class="fw-bold" style="font-size:0.9rem"></span>
                            <button class="btn btn-sm btn-outline-secondary" onclick="changeAdminRosterMonth(1)"><i
                                    class="fas fa-chevron-right"></i></button>
                        </div>
                        <div id="adminRosterCalendar" class="roster-calendar-container"></div>
                    </div>
                    <div id="rosterForm" class="p-3 rounded mb-3 border"
                        style="display:none;background:rgba(255,255,255,0.03)">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="fw-bold mb-0">New Schedule Rule</h6>
                            <button type="button" class="btn-close btn-close-white"
                                onclick="toggleRosterForm()"></button>
                        </div>
                        <div class="btn-group w-100 mb-2" role="group">
                            <input type="radio" class="btn-check" name="ruleType" id="ruleDate" value="date" checked
                                onchange="toggleRuleInputs()"><label class="btn btn-outline-primary btn-sm"
                                for="ruleDate">Specific Date</label>
                            <input type="radio" class="btn-check" name="ruleType" id="ruleWeekly" value="weekly"
                                onchange="toggleRuleInputs()"><label class="btn btn-outline-primary btn-sm"
                                for="ruleWeekly">Weekly</label>
                        </div>
                        <div class="mb-2">
                            <div id="inputDateGroup">
                                <div class="row g-2">
                                    <div class="col-6"><label class="small text-muted">From</label><input type="date"
                                            id="rosterDateStart" class="form-control form-control-sm"></div>
                                    <div class="col-6"><label class="small text-muted">To (Optional)</label><input
                                            type="date" id="rosterDateEnd" class="form-control form-control-sm"></div>
                                </div>
                                <div class="form-text" style="font-size:0.75rem;color:#64748b">Leave "To" empty for
                                    single day.</div>
                            </div>
                            <div id="inputDayGroup" style="display:none"><label class="small text-muted">Day of
                                    Week</label><select id="rosterDay" class="form-select form-select-sm">
                                    <option value="1">Monday</option>
                                    <option value="2">Tuesday</option>
                                    <option value="3">Wednesday</option>
                                    <option value="4">Thursday</option>
                                    <option value="5">Friday</option>
                                    <option value="6">Saturday</option>
                                    <option value="0">Sunday</option>
                                </select></div>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-7"><label class="small text-muted">Doctor</label><select
                                    id="rosterDocSelect" class="form-select form-select-sm"></select></div>
                            <div class="col-5"><label class="small text-muted">Shift</label><select id="rosterShift"
                                    class="form-select form-select-sm">
                                    <option value="Full Day">Full Day</option>
                                    <option value="Morning">Morning</option>
                                    <option value="Evening">Evening</option>
                                    <option value="Off">OFF / Closed</option>
                                </select></div>
                        </div>
                        <div class="d-flex gap-2"><button onclick="addRosterRule()"
                                class="btn btn-success btn-sm flex-grow-1">Save Rule</button><button
                                onclick="toggleRosterForm()" class="btn btn-outline-secondary btn-sm">Cancel</button>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <button onclick="deleteSelectedRules()" id="btnDeleteSelected" class="btn btn-danger btn-sm"
                            disabled><i class="fas fa-trash me-1"></i>Delete Selected</button>
                        <button onclick="clearAllRules()" class="btn btn-outline-danger btn-sm"><i
                                class="fas fa-bomb me-1"></i>Clear All</button>
                    </div>
                    <div class="table-responsive border rounded" style="max-height:50vh">
                        <table class="table table-hover mb-0 align-middle" style="font-size:0.85rem">
                            <thead class="table-light sticky-top">
                                <tr>
                                    <th style="width:40px" class="text-center"><input type="checkbox"
                                            id="selectAllRules" class="form-check-input"
                                            onchange="toggleAllRules(this)"></th>
                                    <th>When</th>
                                    <th>Doctor</th>
                                    <th class="text-end">Action</th>
                                </tr>
                            </thead>
                            <tbody id="rosterList"></tbody>
                        </table>
                        <div id="rosterEmpty" class="text-center p-4 text-muted" style="display:none"><i
                                class="fas fa-calendar-times fs-1 mb-2" style="color:#475569"></i><br>No custom rules
                            set.</div>
                    </div>
                    <div class="p-3 rounded border mt-3" style="background:rgba(255,255,255,0.03)">
                        <h6 class="fw-bold mb-2 small text-uppercase" style="color:var(--primary-light)"><i
                                class="fas fa-user-md me-1"></i>Manage Doctors</h6>
                        <div class="d-flex gap-2 mb-2">
                            <input type="text" id="newDoctorName" class="form-control form-control-sm"
                                placeholder="e.g. Dr. Ahmad (Surgeon)">
                            <button onclick="addDoctor()" class="btn btn-success btn-sm text-nowrap"><i
                                    class="fas fa-plus me-1"></i>Add</button>
                        </div>
                        <div id="doctorManageList" class="border rounded" style="max-height:200px;overflow-y:auto">
                        </div>
                    </div>
                </div>
            </div>
            <!-- Promo Pane -->
            <div class="dash-pane" id="panePromo">
                <div class="dash-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="fw-bold small text-uppercase mb-0" style="color:var(--primary-light)">Promo Section
                        </h6>
                        <div class="form-check form-switch"><input class="form-check-input" type="checkbox"
                                id="promoToggle" onchange="togglePromoSection()"><label class="form-check-label small"
                                for="promoToggle" style="color:#94a3b8">Show on Site</label></div>
                    </div>
                    <div class="p-3 rounded mb-3 border" style="background:rgba(255,255,255,0.03)">
                        <h6 class="fw-bold mb-2 small">Add Promo Item</h6>
                        <div class="mb-2"><input type="text" id="promoImageUrl" class="form-control form-control-sm"
                                placeholder="Image URL (e.g. https://...)" oninput="previewPromoImage()"></div>
                        <div class="mb-2"><label class="btn btn-outline-secondary btn-sm w-100"><i
                                    class="fas fa-upload me-1"></i>Upload from Device<input type="file" accept="image/*"
                                    style="display:none" onchange="handlePromoFileUpload(this)"></label></div>
                        <div id="promoImagePreview" class="mb-2 text-center p-2 border rounded" style="min-height:60px">
                            <span class="text-muted small">Enter a URL or upload an image</span>
                        </div>
                        <div class="mb-2"><input type="text" id="promoText" class="form-control form-control-sm"
                                placeholder="Caption (optional)"></div>
                        <button onclick="addPromoItem()" class="btn btn-success btn-sm w-100"><i
                                class="fas fa-plus me-1"></i>Add Promo</button>
                    </div>
                    <div id="promoItemList" class="border rounded p-2" style="max-height:40vh;overflow-y:auto"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="admin.js"></script>
</body>

</html>